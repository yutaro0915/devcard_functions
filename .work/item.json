{
  "feature_name": "badge-management-system-phase2-visibility-control",
  "status": "ready-for-review",
  "api_changes": [
    {
      "path": "updateBadgeVisibility",
      "method": "Callable Function",
      "change_type": "new-endpoint",
      "breaking": false,
      "details": "ユーザーが自分のバッジ表示設定を変更。パラメータ: {badgeId, showOnPublicCard: boolean, showOnPrivateCard: boolean}",
      "reason": "ユーザーがバッジの表示/非表示を制御できるプライバシー機能"
    },
    {
      "path": "getUserBadges",
      "method": "Callable Function",
      "change_type": "new-endpoint",
      "breaking": false,
      "details": "指定ユーザーの所持バッジ一覧を取得。レスポンス: {badges: UserBadge[]}。visibility設定を含む",
      "reason": "フロントエンドでユーザーのバッジ一覧を表示するため"
    },
    {
      "path": "getPublicCard",
      "method": "Callable Function",
      "change_type": "enhancement",
      "breaking": false,
      "details": "レスポンスに badges?: string[] フィールド追加。showOnPublicCard=true のバッジIDのみ含む",
      "reason": "PublicCardにバッジ情報を統合して一度のAPI呼び出しで取得可能に"
    },
    {
      "path": "getPrivateCard",
      "method": "Callable Function",
      "change_type": "enhancement",
      "breaking": false,
      "details": "レスポンスに badges?: string[] フィールド追加。showOnPrivateCard=true のバッジIDのみ含む",
      "reason": "PrivateCardにバッジ情報を統合して一度のAPI呼び出しで取得可能に"
    }
  ],
  "security_notes": [
    "updateBadgeVisibility は認証必須、自分が所持するバッジのみ変更可能",
    "他人のバッジ表示設定は変更不可（所持していないバッジはnot-foundエラー）",
    "getUserBadges は全ユーザーがアクセス可能（公開情報）",
    "バッジ表示設定の変更は即座にgetPublicCard/getPrivateCardに反映"
  ],
  "tests_required": [
    "ユーザーが自分のバッジ表示設定を更新できる",
    "未認証ユーザーはバッジ表示設定を変更できない（unauthenticated）",
    "所持していないバッジの表示設定を変更しようとした場合エラー（not-found）",
    "指定ユーザーの所持バッジを取得できる（複数バッジ）",
    "getPublicCard のレスポンスに badges フィールドが含まれる",
    "showOnPublicCard=false のバッジは getPublicCard に表示されない",
    "getPrivateCard のレスポンスに badges フィールドが含まれる"
  ],
  "client_work_items": [
    "バッジ表示設定画面の実装（各バッジごとにPublic/Privateのトグル）",
    "getUserBadges APIを使用してユーザープロフィールにバッジ一覧を表示",
    "getPublicCard/getPrivateCard の badges フィールドを使用してカードにバッジを表示",
    "updateBadgeVisibility を使用してバッジ表示設定を更新"
  ],
  "breaking_changes": false,
  "notes_for_frontend": "この変更はすべて非破壊的な追加/拡張です。\n\nPhase 2の追加機能:\n1. ユーザーがバッジ表示を制御できるプライバシー機能（updateBadgeVisibility）\n2. ユーザーのバッジ一覧取得API（getUserBadges）\n3. getPublicCard/getPrivateCard にバッジ情報を統合（badges?: string[]）\n\n推奨UI:\n- バッジ設定画面: 各バッジごとにPublicCard/PrivateCardのトグルスイッチ\n- デフォルト: 両方表示（showOnPublicCard: true, showOnPrivateCard: true）\n- カードプレビュー: 設定変更後、即座に反映\n\n注意事項:\n- badges フィールドはオプショナル（バッジがない場合はundefined）\n- バッジIDの配列のみ返却（詳細情報はlistBadges APIで取得）\n- getSavedCards へのバッジ統合は今後対応予定",
  "backend_commit_sha": null
}
