

## 要件定義書 (簡易版)

### 1. アプリ名 (仮)
DevCard — エンジニアのためのデジタル名刺

### 2. 目的
従来のビジネス用名刺は、エンジニア同士のカジュアルな技術交流には適していない。
DevCardは、GitHub/Qiita/Zennなどの技術発信情報を自動で集約し、「エンジニア文化」に特化したデジタル名刺を「1つのURL」で高速に共有・閲覧できる体験を実現する。

### 3. 対象ユーザー
* 勉強会、ハッカソン、登壇などで活動するエンジニア
* 技術発信を行う学生、個人開発者
* ポートフォリオ共有を簡略化したい層

### 4. 主な機能要件
* **認証:** GitHubまたはX (Twitter) のOAuthでログインできる。
* **プロフィール生成:** 連携サービスから公開情報を取得し、デジタル名刺を自動生成する。
* **カスタマイズ:** 名刺のデザインをCSS編集などでカスタマイズできる。
* **Webでの閲覧:** 相手がアプリを持っていなくても、Webブラウザ（公開URL）だけで名刺を閲覧できる。
* **データ同期:**
    * 連携サービス（GitHub等）の最新情報を自動で名刺に反映する (自動同期)。
    * ユーザーが任意のタイミングで「今すぐ同期」できる (手動同期)。
* **共有 (iOS):**
    * AirDropやLINEなどで、OS標準の「共有シート」を使い、名刺の公開URLを共有できる。
* **共有 (Web):**
    * Web名刺ページにQRコードを表示でき、LINEやX (Twitter) でシェアした際にリッチなプレビュー (OGP) が表示される。
* **アプリ連携:**
    * 共有されたURLをタップした際、アプリがインストールされていればアプリが起動し、なければWebページが開く (Universal Links)。

---

## 基本設計書

### 1. 全体アーキテクチャ
**Firebaseを中心としたサーバーレスアーキテクチャ**を採用する。
iOSアプリは認証と共有の起点、Web (Next.js) は公開閲覧、Cloud Functionsはバックエンドロジック全体を担当する。



### 2. バックエンド (Cloud Functions)
* **言語:** **TypeScript**
* **設計:** 3層レイヤードアーキテクチャ (Application, Domain, Infrastructure) を採用。Mapper層は省略し、Infrastructure (Repository) がデータ変換を兼任する。
* **主な関数:**
    * `Authトリガー (onCreate)`: Firebase Authでのユーザー登録をトリガーに、Firestoreの `/users` に非公開プロフィールを作成する。
    * `HTTPトリガー (onCall)` - `manualSync`: iOSアプリの「手動同期ボタン」から呼び出され、そのユーザーの外部サービス情報を即時同期する。
    * `HTTPトリガー (onCall)` - `saveCustomCss`: iOSアプリからカスタムCSSを受け取り、サニタイズ（無害化）処理を行なってから保存する。
    * `Scheduleトリガー (scheduledSync)`: Webhook実装までのフォールバック、およびWebhook非対応サービスの同期用として、全ユーザーのデータを定期実行（例: 1時間に1回）で同期する。

### 3. 認証 (Firebase Authentication)
* **役割:** アプリの認証基盤として利用。
* **プロバイダ:** **GitHub, X (Twitter) のOAuth**をサポートする。

### 4. データベース (Cloud Firestore)
* **役割:** プライマリデータベース。
* **データ構造:** セキュリティを考慮し、コレクションを明確に分離する。
    * **`/users/{userId}` (非公開コレクション)**
        * **目的:** ユーザー本人しか読み書きできない機密情報（OAuthトークン、CSSの下書き等）。
        * **ルール:** 本人のみ読み書き可。
    * **`/public_cards/{userId}` (公開コレクション)**
        * **目的:** Webで「誰でも」閲覧可能な、サニタイズ済みの安全なデータ（公開プロフィール、記事一覧等）。
        * **ルール:** 読み取りは全員可、書き込みはCloud Functionsのみ可。

### 5. Webフロントエンド (公開名刺)
* **技術:** **Next.js**
* **役割:** `https://devcard.com/username` のような公開名刺ページの表示。サーバーサイドレンダリング (SSR) または静的サイト生成 (SSG) を利用し、LINEやX (Twitter) での**動的OGP（リッチプレビュー）**に対応する。
* **ホスティング:** **Firebase Hosting**

### 6. iOSアプリ (Swift / SwiftUI)
* **役割:** ユーザー認証、プロフィール編集、および共有機能の提供。
* **導入パッケージ (SPM):**
    * `Firebase/Auth`: 認証処理
    * `Firebase/Firestore`: `/users` コレクションの読み書き
    * `Firebase/Functions`: バックエンド関数 ( `manualSync` 等) の呼び出し
* **共有機能:**
    * **`UIActivityViewController` (共有シート)** を使用し、OS標準の共有機能（AirDrop, LINE等）で公開URLのみを共有する。`LinkPresentation`によるプレビューカスタマイズは必須としない。
* **アプリ連携:**
    * **`Universal Links` (ユニバーサルリンク)** を設定。公開URLがタップされた際、アプリインストール済みであればアプリが起動し、名刺追加等の処理に繋げる。
* **主要機能:**
    * **手動同期ボタン:** `Firebase/Functions` を介してバックエンドの `manualSync` 関数を呼び出し、プロフィールを即時更新する。