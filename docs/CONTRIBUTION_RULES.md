# Contribution Rules

このドキュメントは、DevCardバックエンドリポジトリに貢献する際に守るべき境界を定義します。

これらのルールは、人間の開発者にもAIにも等しく適用されます。

## やってはいけないこと

### 1. API仕様を無断で書き換えない

`contracts/` 配下のファイルは、バックエンドとクライアント間の契約です。

以下の行為は禁止：
- テストが通っていない状態で契約を更新する
- 破壊的変更を明記せずに変更する
- CHANGELOGを更新せずに仕様を変える

### 2. 認証・認可・セキュリティの判断を勝手に変えない

以下の変更は、必ず影響を分析してから行う：
- 権限チェックの追加/削除
- バリデーションルールの緩和
- ログ出力の追加（PII漏洩の可能性）
- 外部APIへのデータ送信

### 3. 大規模リファクタリングを独断で行わない

以下の変更は、事前に合意を得る：
- レイヤー構造の変更
- ディレクトリ構成の変更
- 共通モジュールの大幅な書き換え

## 必ずやらなければならないこと

### 1. すべてのAPI変更は .work/item.json で追跡する

- 作業開始時に `.work/item.json` を作成または更新
- `api_changes[]`, `tests_required[]`, `client_work_items[]` を埋める
- 実装完了時に `status` と `breaking_changes` を更新
- コミット前に `.work/item.json` が最新状態であることを確認

詳細は `docs/DEVELOPMENT_PROCESS.md` の「.work/item.json の位置づけ」を参照。

### 2. すべての変更をテストで裏付ける

- 新機能 → 新しいテストを追加
- バグ修正 → 再現テストを追加してから修正
- リファクタリング → テストが壊れないことを確認

### 3. リント/フォーマットを通した状態でレビューに出す

コミット前に必ず実行：
```bash
npm run lint
npm test
```

エラーがある状態でコミットしない。

### 4. 仕様変更時は contracts/CHANGELOG.md を更新する

以下の情報を記録：
- 何を変えたか
- いつ変えたか
- 破壊的変更の有無

### 5. 破壊的変更の影響をまとめる

以下の変更は「破壊的変更」：
- レスポンス構造の変更
- 必須パラメータの追加
- エラーコードの変更
- 認証/認可の強化

破壊的変更がある場合は、以下を明記：
- どのクライアントに影響するか
- どう移行すべきか

## PR提出時の必須項目

Pull Requestには以下の情報を含める：

### 1. 変更の概要
- 何を変えたか（機能追加/バグ修正/リファクタリング）
- なぜ変えたか

### 2. テストの裏付け
- どのテストが担保しているか
- 新しく追加したテストケース

### 3. 破壊的変更の有無
- 既存クライアントへの影響
- マイグレーション手順

### 4. チェックリスト
- [ ] すべてのテストが通る
- [ ] リントエラーがない
- [ ] `.work/item.json` を更新した（API変更の場合）
- [ ] `contracts/API_CONTRACT.md` を更新した（仕様変更の場合）
- [ ] `contracts/CHANGELOG.md` を更新した（仕様変更の場合）
- [ ] `contracts/openapi.yaml` を更新した（仕様変更の場合）
- [ ] `.work/item.json` の `status` が適切（"ready-for-review"等）

## レビュー基準

以下を満たさないPRはマージしない：
- テストが失敗している
- リントエラーがある
- 契約とコードが一致していない
- 破壊的変更が明記されていない

---

**注意**: これらのルールは、コードの品質と契約の正確性を保つためのものです。
