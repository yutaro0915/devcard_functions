# 🧠 GitHub Copilot レビュー方針

**レビュー言語**: 日本語

---

## チェックポイント

### 1. 仕様との整合性

- **PR本文と実装の一致**
  - PR本文に記載された変更内容が実装と一致しているか
  - `.work/item.json` の `api_changes[]`, `breaking_changes`, `security_notes[]` と実装が矛盾していないか

- **Contracts との整合性**
  - `contracts/API_CONTRACT.md` の記述が実装と一致しているか
  - `contracts/CHANGELOG.md` に変更履歴が適切に記録されているか
  - `contracts/openapi.yaml` が実装を正確に反映しているか

- **.work/item.json の更新**
  - `status` が適切に更新されているか（"ready-for-review" など）
  - `tests_required[]` に記載されたテストがすべて実装されているか
  - `client_work_items[]` がフロントエンド側で実装可能な形で記述されているか

---

### 2. セキュリティ

- **認証・認可**
  - 新しいAPIエンドポイントが認証チェックをバイパスしていないか
  - UseCase層で適切に認可判断が行われているか（Handler層ではなく）
  - Firebase Auth の ID トークン検証が正しく実装されているか

- **データ公開範囲**
  - データ公開範囲の変更が意図されたものか
  - PII（個人識別情報）が適切に保護されているか
  - `.work/item.json` の `security_notes[]` に記載された考慮事項が実装に反映されているか

- **バリデーション**
  - Handler層で入力バリデーションが適切に行われているか
  - SQL インジェクション、XSS などの脆弱性がないか
  - ログに機密情報（トークン、パスワード等）が出力されていないか

---

### 3. テスト

- **テストカバレッジ**
  - `.work/item.json` の `tests_required[]` に記載されたテストがすべて実装されているか
  - 追加されたテストが仕様変更を正しくカバーしているか
  - 成功系・失敗系の両方がテストされているか

- **破壊的変更**
  - 破壊的変更（`breaking_changes: true`）に対するテストが存在するか
  - 既存の動作が意図せず壊れていないか（リグレッション）

- **テストの質**
  - 単体テスト（UseCase）と結合テスト（Cloud Functions）が適切に分離されているか
  - テストが実装の詳細ではなく、振る舞いをテストしているか

---

### 4. コード品質

- **アーキテクチャ準拠**
  - Clean Architecture の3層構造（Domain → Application → Infrastructure/Handler）が守られているか
  - ビジネスロジックが Handler 層に漏れていないか
  - Domain 層が他の層に依存していないか

- **コードの冗長性**
  - 重複コード、冗長な処理がないか
  - アンチパターン（God Object, Feature Envy など）がないか

- **型安全性**
  - TypeScript の型定義が適切か
  - `any` 型の乱用がないか
  - null/undefined の扱いが安全か

- **エラーハンドリング**
  - 例外処理が適切に行われているか
  - ユーザーフレンドリーなエラーメッセージが返されているか
  - 内部実装の詳細がエラーメッセージに漏れていないか

---

### 5. ドキュメント更新

- **Contracts の更新**
  - `contracts/API_CONTRACT.md` が実装と一致しているか
  - `contracts/CHANGELOG.md` に変更履歴が記録されているか
  - `contracts/openapi.yaml` が最新の実装を反映しているか

- **.work/item.json の更新**
  - すべての必須フィールドが適切に埋まっているか
  - `status` が "ready-for-review" に更新されているか
  - `breaking_changes` フラグが正しく設定されているか

- **コメントと命名**
  - 関数名・変数名が変更意図を正しく反映しているか
  - 複雑なロジックに適切なコメントがあるか
  - コメントが実装と矛盾していないか

---

## レビュー出力形式

上記観点に基づき、以下の形式でコメントを出力してください：

### ✅ 良い点
- [実装の優れている点]

### ⚠️ 懸念点
- [セキュリティ、品質、仕様整合性の問題]

### 💡 改善提案
- [より良い実装方法の提案]

### 📋 確認事項
- [レビュワーに確認してほしい点]

---

**重要**: Copilot は PR 全体を分析し、上記観点に基づくコメントを**日本語**で出力してください。
